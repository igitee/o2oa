MWF.xApplication.cms.FormDesigner.Module=MWF.xApplication.cms.FormDesigner.Module||{};MWF.xDesktop.requireApp("process.FormDesigner","Module.Form",null,false);MWF.xDesktop.requireApp("cms.FormDesigner","Property",null,false);MWF.xApplication.cms.FormDesigner.Module.Form=MWF.CMSFCForm=new Class({Extends:MWF.FCForm,options:{style:"default",propertyPath:"/x_component_cms_FormDesigner/Module/Form/form.html",mode:"PC",fields:["Calendar","Checkbox","Datagrid","Datagrid$Title","Datagrid$Data","Htmleditor","Number","Office","Orgfield","Personfield","Readerfield","Authorfield","Radio","Select","Textarea","Textfield"]},initialize:function(e,t,i){this.setOptions(i);this.path="/x_component_process_FormDesigner/Module/Form/";this.cssPath="/x_component_process_FormDesigner/Module/Form/"+this.options.style+"/css.wcss";this._loadCss();this.container=null;this.form=this;this.moduleType="form";this.moduleList=[];this.moduleNodeList=[];this.moduleContainerNodeList=[];this.moduleElementNodeList=[];this.moduleComponentNodeList=[];this.dataTemplate={};this.designer=e;this.container=t;this.selectedModules=[]},loadStylesList:function(t){var e="/x_component_cms_FormDesigner/Module/Form/template/"+(this.options.mode=="Mobile"?"styles":"styles")+".json";MWF.getJSON(e,{onSuccess:function(e){this.stylesList=e;if(t)t(this.stylesList)}.bind(this),onRequestFailure:function(){this.stylesList={};if(t)t(this.stylesList)}.bind(this),onError:function(){this.stylesList={};if(t)t(this.stylesList)}.bind(this)})},loadModule:function(e,t,i){if(MWF["CMSFC"+e.type]){var s=new MWF["CMSFC"+e.type](this);s.load(e,t,i);return s}else{var s=new MWF["CMSFCDiv"](this);s.load(e,t,i);return s}},createModule:function(s,o){var r="CMSFC";this.getTemplateData(s,function(e){var t=Object.clone(e);var i=new MWF[r+s](this);i.create(t,o)}.bind(this))},getTemplateData:function(i,s){if(this.dataTemplate[i]){if(s)s(this.dataTemplate[i])}else{var e=MWF.CMSFD.ResetTemplateModules.indexOf(i.toLowerCase())!=-1?"x_component_cms_FormDesigner":"x_component_process_FormDesigner";var t="/"+e+"/Module/"+i+"/template.json";MWF.getJSON(t,function(e,t){this.dataTemplate[i]=e;if(s)s(e)}.bind(this))}},showProperty:function(){if(!this.property){this.property=new MWF.xApplication.cms.FormDesigner.Property(this,this.designer.propertyContentArea,this.designer,{path:this.options.propertyPath,onPostLoad:function(){this.property.show()}.bind(this)});this.property.load()}else{this.property.show()}},save:function(e){this.designer.saveForm()},preview:function(){MWF.xDesktop.requireApp("cms.FormDesigner","Preview",function(){if(this.options.mode=="Mobile"){this.previewBox=new MWF.xApplication.cms.FormDesigner.Preview(this,{size:{x:"340",y:580}})}else{this.previewBox=new MWF.xApplication.cms.FormDesigner.Preview(this)}this.previewBox.load()}.bind(this))}});