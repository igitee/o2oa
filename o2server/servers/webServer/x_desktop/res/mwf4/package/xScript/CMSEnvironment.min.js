MWF.xScript=MWF.xScript||{};MWF.xScript.CMSEnvironment=function(t){var n=t.data;var f=t.form;var a=t.forms;this.library=COMMON;var i=function(t){return new MWF.xScript.CMSJSONData(t,function(t,n,i){var e={getKey:function(){return n},getParent:function(){return i}};while(e&&!a[e.getKey()])e=e.getParent();if(e)if(e.getKey())if(a[e.getKey()])a[e.getKey()].resetData()})};this.setData=function(t){this.data=i(t);this.data.save=function(n){form.documentAction.saveData(function(t){if(n)n()}.bind(this),null,document.id,jData)}};this.setData(n);this.documentContext={getDocument:function(){return t.document},getControl:function(){return t.control},getAttachmentList:function(){return t.attachmentList}};this.Dict=MWF.xScript.createCMSDict(f.json.application);var r=null;var o=function(){if(!r){MWF.require("MWF.xScript.Actions.UnitActions",null,false);r=new MWF.xScript.Actions.UnitActions}};var s=function(t){var n=typeOf(t);if(n==="array"){var i=[];t.each(function(t){i.push(typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t)});return i}else{return[n==="object"?t.distinguishedName||t.id||t.unique||t.name:t]}};this.org={getGroup:function(t){o();var n={groupList:s(t)};var i=null;r.listGroup(n,function(t){i=t.data},null,false);return i&&i.length===1?i[0]:i},listSubGroup:function(t,n){o();var i={groupList:s(t)};var e=null;if(n){r.listSubGroupNested(i,function(t){e=t.data},null,false)}else{r.listSubGroupDirect(i,function(t){e=t.data},null,false)}return e},listSupGroup:function(t,n){o();var i={groupList:s(t)};var e=null;if(n){r.listSupGroupNested(i,function(t){e=t.data},null,false)}else{r.listSupGroupDirect(i,function(t){e=t.data},null,false)}return e},listGroupWithPerson:function(t){o();var n={personList:s(t)};var i=null;r.listGroupWithPerson(n,function(t){i=t.data},null,false);return i},groupHasRole:function(t,n){o();nameFlag=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var i={group:nameFlag,roleList:s(n)};var e=false;r.groupHasRole(i,function(t){e=t.data.value},null,false);return e},getRole:function(t){o();var n={roleList:s(t)};var i=null;r.listRole(n,function(t){i=t.data},null,false);return i&&i.length===1?i[0]:i},listRoleWithPerson:function(t){o();var n={personList:s(t)};var i=null;r.listRoleWithPerson(n,function(t){i=t.data},null,false);return i},personHasRole:function(t,n){o();nameFlag=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var i={person:nameFlag,roleList:s(n)};var e=false;r.personHasRole(i,function(t){e=t.data.value},null,false);return e},getPerson:function(t){o();var n={personList:s(t)};var i=null;r.listPerson(n,function(t){i=t.data},null,false);return i&&i.length===1?i[0]:i},listSubPerson:function(t,n){o();var i={personList:s(t)};var e=null;if(n){r.listPersonSubNested(i,function(t){e=t.data},null,false)}else{r.listPersonSubDirect(i,function(t){e=t.data},null,false)}return e},listSupPerson:function(t,n){o();var i={personList:s(t)};var e=null;if(n){r.listPersonSupNested(i,function(t){e=t.data},null,false)}else{r.listPersonSupDirect(i,function(t){e=t.data},null,false)}return e},listPersonWithGroup:function(t){o();var n={groupList:s(t)};var i=null;r.listPersonWithGroup(n,function(t){i=t.data},null,false);return i},listPersonWithRole:function(t){o();var n={roleList:s(t)};var i=null;r.listPersonWithRole(n,function(t){i=t.data},null,false);return i},listPersonWithIdentity:function(t){o();var n={identityList:s(t)};var i=null;r.listPersonWithIdentity(n,function(t){i=t.data},null,false);return i},listPersonWithUnit:function(t,n){o();var i={unitList:s(t)};var e=null;if(n){r.listPersonWithUnitNested(i,function(t){e=t.data},null,false)}else{r.listPersonWithUnitDirect(i,function(t){e=t.data},null,false)}return e},appendPersonAttribute:function(t,n,i){o();var e=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var a={attributeList:i,name:n,person:e};r.appendPersonAttribute(a,function(t){if(t.data.value){if(success)success()}else{if(failure)failure(null,"","append values failed")}},function(t,n,i){if(failure)failure(t,n,i)},false)},setPersonAttribute:function(t,n,i){o();var e=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var a={attributeList:i,name:n,person:e};r.setPersonAttribute(a,function(t){if(t.data.value){if(success)success()}else{if(failure)failure(null,"","append values failed")}},function(t,n,i){if(failure)failure(t,n,i)},false)},getPersonAttribute:function(t,n){o();var i=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var e={name:n,person:i};var a=null;r.getPersonAttribute(e,function(t){a=t.data.attributeList},null,false);return a},listPersonAttributeName:function(t){o();var n={personList:s(t)};var i=null;r.listPersonAttributeName(n,function(t){i=t.data.nameList},null,false);return i},listPersonAllAttribute:function(t){o();var n={personList:s(t)};var i=null;r.listPersonAllAttribute(n,function(t){i=t.data},null,false);return i},getIdentity:function(t){o();var n={identityList:s(t)};var i=null;r.listIdentity(n,function(t){i=t.data},null,false);return i&&i.length===1?i[0]:i},listIdentityWithPerson:function(t){o();var n={personList:s(t)};var i=null;r.listIdentityWithPerson(n,function(t){i=t.data},null,false);return i},listIdentityWithUnit:function(t,n){o();var i={unitList:s(t)};var e=null;if(n){r.listIdentityWithUnitNested(i,function(t){e=t.data},null,false)}else{r.listIdentityWithUnitDirect(i,function(t){e=t.data},null,false)}return e},getUnit:function(t){o();var n={unitList:s(t)};var i=null;r.listUnit(n,function(t){i=t.data},null,false);return i&&i.length===1?i[0]:i},listSubUnit:function(t,n){o();var i={unitList:s(t)};var e=null;if(n){r.listUnitSubNested(i,function(t){e=t.data},null,false)}else{r.listUnitSubDirect(i,function(t){e=t.data},null,false)}return e},listSupUnit:function(t,n){o();var i={unitList:s(t)};var e=null;if(n){r.listUnitSupNested(i,function(t){e=t.data},null,false)}else{r.listUnitSupDirect(i,function(t){e=t.data},null,false)}return e},getUnitByIdentity:function(t,n){o();var i="current";var e;if(n){if(typeOf(n)==="string")i="type";if(typeOf(n)==="number")i="level"}switch(i){case"current":var a={identity:typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t,level:n};r.getUnitWithIdentityAndLevel(a,function(t){e=t.data},null,false);break;case"type":var a={identity:typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t,type:n};r.getUnitWithIdentityAndType(a,function(t){e=t.data},null,false);break;case"level":var a={identityList:s(t)};r.listUnitWithIdentity(a,function(t){e=t.data},null,false);break}return e},listAllSupUnitWithIdentity:function(t){o();var n={identityList:s(t)};var i=null;r.listUnitSupNestedWithIdentity(n,function(t){i=t.data},null,false);return i},listUnitWithPerson:function(t){o();var n={personList:s(t)};var i=null;r.listUnitWithPerson(n,function(t){i=t.data},null,false);return i},listAllSupUnitWithPerson:function(t){o();var n={personList:s(t)};var i=null;r.listUnitSupNestedWithPerson(n,function(t){i=t.data},null,false);return i},listUnitWithAttribute:function(t,n){o();var i={name:t,attribute:n};var e=null;r.listUnitWithAttribute(i,function(t){e=t.data},null,false);return e},listUnitWithDuty:function(t,n){o();var i={name:"",identity:typeOf(n)==="object"?n.distinguishedName||n.id||n.unique||n.name:n};var e=null;r.listUnitWithDuty(i,function(t){e=t.data},null,false);return e},listTopUnit:function(){var t=MWF.Actions.get("x_organization_assemble_control");var n=null;t.listTopUnit(function(t){n=t.data},null,false);return n},getDuty:function(t,n){o();var i={name:t,unit:typeOf(n)==="object"?n.distinguishedName||n.id||n.unique||n.name:n};var e=null;r.getDuty(i,function(t){e=t.data},null,false);return e},listDutyNameWithIdentity:function(t){o();var n={identityList:s(t)};var i=null;r.listDutyNameWithIdentity(n,function(t){i=t.data.nameList},null,false);return i},listDutyNameWithUnit:function(t){o();var n={unitList:s(t)};var i=null;r.listDutyNameWithUnit(n,function(t){i=t.data.nameList},null,false);return i},listUnitAllDuty:function(t){o();var n={unitList:s(t)};var i=null;r.listUnitAllDuty(n,function(t){i=t.data.nameList},null,false);return i},appendUnitAttribute:function(t,n,i){o();var e=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var a={attributeList:i,name:n,unit:e};r.appendUnitAttribute(a,function(t){if(t.data.value){if(success)success()}else{if(failure)failure(null,"","append values failed")}},function(t,n,i){if(failure)failure(t,n,i)},false)},setUnitAttribute:function(t,n,i){o();var e=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var a={attributeList:i,name:n,unit:e};r.setUnitAttribute(a,function(t){if(t.data.value){if(success)success()}else{if(failure)failure(null,"","append values failed")}},function(t,n,i){if(failure)failure(t,n,i)},false)},getUnitAttribute:function(t,n){o();var i=typeOf(t)==="object"?t.distinguishedName||t.id||t.unique||t.name:t;var e={name:n,unit:i};var a=null;r.getUnitAttribute(e,function(t){a=t.data.attributeList},null,false);return a},listUnitAttributeName:function(t){o();var n={unitList:s(t)};var i=null;r.listUnitAttributeName(n,function(t){i=t.data.nameList},null,false);return i},listUnitAllAttribute:function(t){o();var n={unitList:s(t)};var i=null;r.listUnitAllAttribute(n,function(t){i=t.data},null,false);return i}};this.Action=function(){var e=[];return function(t,n){var i=e[t]||(e[t]=new MWF.xDesktop.Actions.RestActions("",t,""));i.getActions=function(t){if(!this.actions)this.actions={};Object.merge(this.actions,n);if(t)t()};this.invoke=function(t){i.invoke(t)}}}();this.service={jaxwsClient:{},jaxrsClient:{}};var e=null;var l=function(t){if(!e){MWF.require("MWF.xDesktop.Actions.RestActions",function(){e=new MWF.xDesktop.Actions.RestActions("","x_cms_assemble_control","");e.getActions=function(t){this.actions={lookup:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}/execute",method:"PUT"},getView:{uri:"/jaxrs/queryview/flag/{view}/application/flag/{application}"}};if(t)t()};if(t)t()}.bind(this))}else{if(t)t()}};this.view={lookup:function(t,i){var n={filterList:t.filter||null};MWF.Actions.get("x_query_assemble_surface").loadView(t.view,t.application,n,function(t){var n={grid:t.data.grid,groupGrid:t.data.groupGrid};if(i)i(n)})},lookupV1:function(t,i){l(function(){e.invoke({name:"lookup",async:true,parameter:{view:t.view,application:t.application},success:function(t){var n={grid:t.data.grid,groupGrid:t.data.groupGrid};if(i)i(n)}.bind(this)})}.bind(this))},select:function(t,e,a){if(t.view){var r={application:t.application||f.json.application,viewName:t.view||"",isTitle:t.isTitle||"yes",select:t.select||"multi"};if(!a)a={};var o=a.width||"700";var s=a.height||"400";if(layout.mobile){var n=document.body.getSize();o=n.x;s=n.y;a.style="viewmobile"}o=o.toInt();s=s.toInt();var n=f.app.content.getSize();var l=(n.x-o)/2;var u=(n.y-s)/2;if(l<0)l=0;if(u<0)u=0;if(layout.mobile){l=20;u=0}var c=this;MWF.require("MWF.xDesktop.Dialog",function(){var n=new MWF.xDesktop.Dialog({title:a.title||"select view",style:a.style||"view",top:u,left:l-20,fromTop:u,fromLeft:l-20,width:o,height:s,html:"<div style='height: 100%;'></div>",maskNode:f.app.content,container:f.app.content,buttonList:[{text:MWF.LP.process.button.ok,action:function(){if(e)e(c.view.getData());this.close()}},{text:MWF.LP.process.button.cancel,action:function(){this.close()}}]});n.show();if(layout.mobile){var t=n.node.getElement(".MWF_dialod_Action_back");var i=n.node.getElement(".MWF_dialod_Action_ok");if(t)t.addEvent("click",function(t){n.close()}.bind(this));if(i)i.addEvent("click",function(t){if(e)e(this.view.getData());n.close()}.bind(this))}MWF.xDesktop.requireApp("query.Query","Viewer",function(){this.view=new MWF.xApplication.query.Query.Viewer(n.content.getFirst(),r,{style:"select"})}.bind(this))}.bind(this))}}};if(!window.includedScripts){var u=window.includedScripts=[]}else{var u=window.includedScripts}this.include=function(t,n){var i=t;if(typeOf(i)=="string"){i={name:i}}var e=i.name;var a=i.type&&i.application?i.type:"cms";var r=i.application||f.json.application;if(u.indexOf(e)>-1){if(n)n.apply(this);return}var o;switch(a){case"portal":if(this.scriptActionPortal){o=this.scriptActionPortal}else{MWF.require("MWF.xScript.Actions.PortalScriptActions",null,false);o=this.scriptActionPortal=new MWF.xScript.Actions.PortalScriptActions}break;case"process":if(this.scriptActionProcess){o=this.scriptActionProcess}else{MWF.require("MWF.xScript.Actions.ScriptActions",null,false);o=this.scriptActionProcess=new MWF.xScript.Actions.ScriptActions}break;case"cms":if(this.scriptActionCMS){o=this.scriptActionCMS}else{MWF.require("MWF.xScript.Actions.CMSScriptActions",null,false);o=this.scriptActionCMS=new MWF.xScript.Actions.CMSScriptActions}break}o.getScriptByName(r,e,u,function(t){if(t.data){u=u.concat(t.data.importedList);MWF.Macro.exec(t.data.text,this);if(n)n.apply(this)}else{if(n)n.apply(this)}}.bind(this),null,false)};this.define=function(t,n,i){var e=true;if(i===false)e=false;var a={};a[t]={value:n,configurable:e};MWF.defineProperties(this,a)}.bind(this);this.form={getInfor:function(){return t.formInfor},infor:t.formInfor,getApp:function(){return f.app},app:f.app,node:function(){return f.node},readonly:f.options.readonly,get:function(t){return f.all?f.all[t]:null},getField:function(t){return a[t]},getAction:function(){return f.documentAction},getData:function(){return new MWF.xScript.CMSJSONData(f.getData())},save:function(t){f.saveDocument(t)},close:function(){f.closeDocument()},publish:function(t){f.publishDocument()},confirm:function(t,n,i,e,a,r,o,s,l){f.confirm(t,n,i,e,a,r,o,s,l)},notice:function(t,n,i,e){f.notice(t,n,i,e)},addEvent:function(t,n){f.addEvent(t,n)},openWork:function(t,n,i,e){var a=e||{};a.workId=t;a.workCompletedId=n;a.docTitle=i;a.appId="process.Work"+(a.workId||a.workCompletedId);layout.desktop.openApplication(this.event,"process.Work",a)},openDocument:function(t,n,i){var e=i||{};e.documentId=t;e.docTitle=n;layout.desktop.openApplication(this.event,"cms.Document",e)},openPortal:function(t,i,e){var a=MWF.Actions.get("x_portal_assemble_surface");a.getApplication(t,function(n){if(n.data){if(i){a.getPageByName(i,n.data.id,function(t){layout.desktop.openApplication(null,"portal.Portal",{portalId:n.data.id,pageId:t.data?t.data.id:"",parameters:e,appId:"portal.Portal"+n.data.id})})}else{layout.desktop.openApplication(null,"portal.Portal",{portalId:n.data.id,parameters:e,appId:"portal.Portal"+n.data.id})}}})},openCMS:function(t){var n=MWF.Actions.get("x_cms_assemble_control");n.getColumn(t,function(t){if(t.data){layout.desktop.openApplication(null,"cms.Module",{columnId:t.data.id,appId:"cms.Module"+t.data.id})}})},openProcess:function(t){var n=MWF.Actions.get("x_processplatform_assemble_surface");n.getApplication(t,function(t){if(t.data){layout.desktop.openApplication(null,"process.Application",{id:t.data.id,appId:"process.Application"+t.data.id})}})},openApplication:function(t,n){layout.desktop.openApplication(null,t,n)},createDocument:function(t,n,i,e,a,r,o,s,l){var u=t;if(typeOf(t)=="object"){u=t.column;n=t.category;i=t.data;e=t.identity;a=t.callback;r=t.target;o=t.latest;s=t.selectColumnEnable;l=t.ignoreTitle}if(r){if(layout.app&&layout.app.inBrowser){layout.app.content.empty();layout.app=null}}MWF.xDesktop.requireApp("cms.Index","Newer",function(){var t=new MWF.xApplication.cms.Index.Newer(null,null,f.app,null,{documentData:i,identity:e,ignoreTitle:l===true,ignoreDrafted:o===false,selectColumnEnable:!n||s===true,restrictToColumn:!!n&&s!==true,categoryFlag:n,columnFlag:u,onStarted:function(t,n){if(a)a()},onPostLoad:function(){},onPostPublish:function(){}});t.load()})},startProcess:function(t,n,i,e,r,a,o){if(arguments.length>2){for(var s=2;s<arguments.length;s++){if(typeOf(arguments[s])=="boolean"){a=arguments[s];break}}}if(a){if(layout.app&&layout.app.inBrowser){layout.app.content.empty();layout.app=null}}var l=MWF.Actions.get("x_processplatform_assemble_surface").getProcessByName(n,t,function(n){if(n.data){MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){var t=new MWF.xApplication.process.TaskCenter.ProcessStarter(n.data,f.app,{workData:i,identity:e,latest:o,onStarted:function(t,n,i){debugger;var e=[];t.each(function(t){if(t.currentTaskIndex!=-1)e.push(t.taskList[t.currentTaskIndex].work)}.bind(this));if(e.length==1){var a={workId:e[0],appId:e[0]};layout.desktop.openApplication(null,"process.Work",a)}else{}if(r)r(t)}.bind(this)});t.load()}.bind(this))}})}};this.target=t.target;this.event=t.event;this.status=t.status;this.session=layout.desktop.session};MWF.xScript.CMSJSONData=function(o,s,e,a){var l=function(t,n,i,e){return function(){return["array","object"].indexOf(typeOf(t[i]))===-1?t[i]:new MWF.xScript.CMSJSONData(t[i],n,i,e)}};var u=function(n,i,e,a){return function(t){n[e]=t;if(i)i(n,e,a)}};var t=function(){var t={};for(var n in o)t[n]={configurable:true,enumerable:true,get:l.apply(this,[o,s,n,this]),set:u.apply(this,[o,s,n,this])};t["length"]={get:function(){return Object.keys(o).length}};MWF.defineProperties(this,t);var i={getKey:{value:function(){return e}},getParent:{value:function(){return a}},toString:{value:function(){return o.toString()}},add:{value:function(t,n,i){var e=true;var a=typeOf(o);if(a==="array"){if(arguments.length<2){o.push(t);n=t;t=o.length-1}else{if(!t&&t!==0){o.push(n);t=o.length-1}else{e=false}}if(e){var r={};r[t]={configurable:true,enumerable:true,get:l.apply(this,[o,s,t,this]),set:u.apply(this,[o,s,t,this])};MWF.defineProperties(this,r)}this[t]=n}else if(a==="object"){if(!this.hasOwnProperty(t)){o[t]=n;if(e){var r={};r[t]={configurable:true,enumerable:true,get:l.apply(this,[o,s,t,this]),set:u.apply(this,[o,s,t,this])};MWF.defineProperties(this,r)}this[t]=n}else{if(i)this[t]=n}}return this[t]}},del:{value:function(t){if(!this.hasOwnProperty(t))return null;delete o[newKey];delete this[newKey];return this}}};MWF.defineProperties(this,i)};var n=typeOf(o);if(n==="object"||n==="array")t.apply(this)};MWF.xScript.createCMSDict=function(e){return function(t){var n=t;if(typeOf(n)=="string"){n={name:n}}var i=this.name=n.name;var r=n.type&&n.application?n.type:"cms";var o=n.application||e;var s=n.enableAnonymous||false;if(r=="cms"){var l=MWF.Actions.get("x_cms_assemble_control")}else{var l=MWF.Actions.get("x_processplatform_assemble_surface")}var u=function(t){var n=t.split(/\./g);var i=n.map(function(t){return encodeURIComponent(t)});return i.join("/")};this.get=function(t,n,e){debugger;var i=null;if(t){var a=u(t);l[s&&r=="cms"?"getDictDataAnonymous":"getDictData"](encodeURIComponent(this.name),o,a,function(t){i=t.data;if(n)n(t.data)},function(t,n,i){if(e)e(t,n,i)},false)}else{l[s&&r=="cms"?"getDictRootAnonymous":"getDictRoot"](encodeURIComponent(this.name),o,function(t){i=t.data;if(n)n(t.data)},function(t,n,i){if(e)e(t,n,i)},false)}return i};this.set=function(t,n,i,e){var a=u(t);l.setDictData(encodeURIComponent(this.name),o,a,n,function(t){if(i)i(t.data)},function(t,n,i){if(e)e(t,n,i)})};this.add=function(t,n,i,e){var a=u(t);l.addDictData(encodeURIComponent(this.name),o,a,n,function(t){if(i)i(t.data)},function(t,n,i){if(e)e(t,n,i)})};this["delete"]=function(t,n,e){var i=u(t);l.deleteDictData(encodeURIComponent(this.name),o,i,function(t){if(n)n(t.data)},function(t,n,i){if(e)e(t,n,i)})};this.destory=this["delete"]}};