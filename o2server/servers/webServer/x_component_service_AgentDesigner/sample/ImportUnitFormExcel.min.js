print("批量导入组织");var File=Java.type("java.io.File");var Config={interfaceUrl:"http://ahpp.zoneland.net:20030/x_program_center/jaxrs/invoke/unitAsync/execute",localPath:File.separator+"data"+File.separator+"ImportUnitFromExcel"+File.separator,recordLocalPath:File.separator+"data"+File.separator+"ImportUnitFromExcelRecord"+File.separator};var Utils={parseResp:function(e){if(!e||e===null){return{type:"error",message:"服务响应是null，需要管理员查看后台日志"}}else{var r=JSON.parse(e.toString());return r}},getFailText:function(e){var r;if(e.message){r=e.message+(e.prompt?"("+e.prompt+")":"")}else if(e.prompt){r=e.prompt}else{r="未知异常"}print(r);return r}};function getFileList(){var e=Config.localPath;var r=new File(e);var a=Java.type("java.util.ArrayList");var t=new a;if(r.exists()){var i=r.listFiles();for(var s=0;s<i.length;s++){if(i[s].isFile()){print(i[s].getName());var l=i[s].getName().split(".");if(l[l.length-1].equals("xls")){t.add(i[s])}}}}else{print("目录不存在:"+e)}return t}function importExcel(e){var r=Java.type("java.io.FileInputStream");var a="";var t=null;try{t=new r(e);var i=null;try{var s=e.getName();if(s.endsWith(".xls")){var l=Java.type("org.apache.poi.hssf.usermodel.HSSFWorkbook");i=new l(t)}else if(s.endsWith(".xlsx")){var n=Java.type("org.apache.poi.hssf.usermodel.XSSFWorkbook");i=new n(t)}else{a="不支持的文件类型！";print(a);return false}}catch(e){a="解析Excel文件出错！";print(a);e.printStackTrace();return false}finally{t.close()}if(a.length===0){var o=null!==i?i.getNumberOfSheets():0;var p=i.getSheetAt(0);var c=p.getPhysicalNumberOfRows();if(c>1){for(var u=1;u<c;u++){print("正在执行导入第"+u+"行");var v=p.getRow(u);var f=v.getLastCellNum();if(f>0){a=importRow(v,f);if(a!=="")return false}}}else{a="EXCEL没有数据，请确定。"}}if(a.length()>0){print("错误消息："+a);return false}else{print(e.getName()+"导入成功！");return true}}catch(e){e.printStackTrace();return false}}var Cell=Java.type("org.apache.poi.ss.usermodel.Cell");function importRow(e,r){var a={action:"add",attributeList:[]};print("cells = "+r);for(var t=0;t<r;t++){var i="";var s=e.getCell(t);if(s!==null){s.setCellType(Cell.CELL_TYPE_STRING);i=s.getStringCellValue().trim()}var l=true;switch(t){case 1:if(i.substr(0,2)!="00"){i="00"+i}a.unique=i;break;case 4:a.typeList=[i.toLowerCase()];break;case 5:a.name=i;break;case 6:var n={name:"displayName",value:i};a.attributeList.push(n);break;case 7:a.description=i;break;case 9:a.orderNumber=i;break;case 10:if(i!=="0"){if(i.substr(0,2)!="00"){i="00"+i}a.superior=i}break;case 12:if(i.toLowerCase()!=="active")l=false;break;case 18:var n={name:"postalcode",value:i};a.attributeList.push(n);break}if(!l)return""}if(!a.unique||a.unique=="0")return"";return sendRequest(a)}function sendRequest(e){var r="";try{if(typeof e=="string")e=JSON.parse(bodyStr);e.saveFlag="no";var a=com.x.base.core.project.connection.CipherConnectionAction.post(false,Config.interfaceUrl,JSON.stringify(e));var t=Utils.parseResp(a);if(t.type&&t.type=="success"&&t.data&&t.data.value&&t.data.value.result&&t.data.value.result=="success"){}else{r=Utils.getFailText(t)}}catch(e){r=e.printStackTrace()}finally{print("resend person errorText="+r);return r}}function init(){var e=getFileList();for(var r=0;r<e.size();r++){try{var a=e.get(r);if(importExcel(a)){print("正在修改文件目录："+a.getName());var t=Config.recordLocalPath+a.getName();if(a.renameTo(new File(t))){print("文件移动到了:"+t)}else{print(a.getName()+" is failed to move!")}}}catch(e){e.printStackTrace()}}}init();