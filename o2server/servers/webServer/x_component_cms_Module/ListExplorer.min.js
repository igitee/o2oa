MWF.xApplication.cms=MWF.xApplication.cms||{};MWF.xApplication.cms.Module=MWF.xApplication.cms.Module||{};MWF.require("MWF.xAction.org.express.RestActions",null,false);MWF.require("MWF.widget.Mask",null,false);MWF.require("MWF.widget.O2Identity",null,false);MWF.xDesktop.requireApp("cms.Module","lp."+MWF.language,null,false);MWF.xDesktop.requireApp("cms.Module","package",null,false);MWF.xApplication.cms.Module.ListExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",status:"published",isAdmin:false,searchKey:"",tooltip:{}},initialize:function(t,e,i,s,o,n,r){this.setOptions(n);this.setTooltip();this.path="/x_component_cms_Module/$ListExplorer/";this.cssPath="/x_component_cms_Module/$ListExplorer/"+this.options.style+"/css.wcss";this._loadCss();this.categoryData=s;this.columnData=i;this.revealData=o;this.actions=e;this.node=$(t);this.searchNode=$(r);this.initData();if(!this.personActions)this.personActions=new MWF.xAction.org.express.RestActions},setTooltip:function(t){if(t)this.options.tooltip=Object.merge(this.options.tooltip,t)},initData:function(){this.toolItemNodes=[]},reload:function(){this.node.empty();this.searchNode.empty();this.load()},load:function(){this.loadSearchNode();this.loadViewData(function(){this.loadContentNode();this.loadView();this.setNodeScroll()}.bind(this))},loadViewData:function(i){if(this.revealData.isAll){if(i)i()}else if(this.revealData.id=="defaultList"){if(i)i()}else if(this.revealData.type=="list"){this.app.restActions.getView(this.revealData.id,function(t){var e=this.viewData=t.data;if(e.content&&typeof e.content=="string"){e.content=JSON.parse(e.content)}if(i)i()}.bind(this))}},loadToolbar:function(){var t=this.path+"toolbar.json";MWF.getJSON(t,function(t){t.each(function(t){this.createToolbarItemNode(t)}.bind(this))}.bind(this))},createToolbarItemNode:function(t){var e=new Element("div",{styles:t.styles&&this.css[t.styles]?this.css[t.styles]:this.css.toolbarItemNode});e.store("toolData",t);var i=new Element("div",{styles:this.css.toolbarItemIconNode}).inject(e);i.setStyle("background-image","url("+this.path+this.options.style+"/icon/"+t.icon+")");var s=new Element("div",{styles:this.css.toolbarItemTextNode,text:t.title});s.inject(e);e.inject(this.toolbarNode);this.toolItemNodes.push(e);this.setToolbarItemEvent(e)},setToolbarItemEvent:function(t){var e=this;t.addEvents({click:function(){var t=this.retrieve("toolData");if(e[t.action])e[t.action].apply(e,[this])}})},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node);this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},loadView:function(){if(this.revealData.isAll){this.view=new MWF.xApplication.cms.Module.ListExplorer.ListForALL(this.elementContentNode,this.app,this,this.viewData,this.options.searchKey)}else if(this.revealData.id=="defaultList"||this.options.searchKey&&this.options.searchKey!=""){this.view=new MWF.xApplication.cms.Module.ListExplorer.DefaultList(this.elementContentNode,this.app,this,this.viewData,this.options.searchKey)}else{this.view=new MWF.xApplication.cms.Module.ListExplorer.List(this.elementContentNode,this.app,this,this.viewData)}this.view.load();this.setContentSize()},setContentSize:function(){var t=this.toolbarNode?this.toolbarNode.getSize():{x:0,y:0};var e=this.app.titleBar?this.app.titleBar.getSize():{x:0,y:0};var i=this.app.node.getSize();var s=0;var o=0;var n=this.filterConditionNode?this.filterConditionNode.getSize():{x:0,y:0};var r=i.y-t.y-s-o-n.y-e.y;this.elementContentNode.setStyle("height",""+r+"px");this.pageCount=(r/40).toInt()+5;if(this.view.items.length<this.pageCount){this.view.loadElementList(this.pageCount-this.view.items.length)}},setNodeScroll:function(){var o=this;MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.elementContentNode,{indent:false,style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(t){var e=o.elementContentNode.getScrollSize();var i=o.elementContentNode.getSize();var s=e.y-i.y;if(t+200>s){if(!o.view.isItemsLoaded)o.view.loadElementList()}}})}.bind(this))},loadFileter:function(t){this._loadFileter(t)},_loadFileter:function(t){if(!this.filter){this.filter=new MWF.xApplication.cms.Module.Module.Filter(this.app,this,this.toolbarNode,t,this.filterConditionNode,this.actions,this.css);this.filter.load()}else{this.filter.load()}},loadSearchNode:function(){this.searchBarAreaNode=new Element("div",{styles:this.css.searchBarAreaNode}).inject(this.searchNode);this.searchBarNode=new Element("div",{styles:this.css.searchBarNode}).inject(this.searchBarAreaNode);this.searchBarActionNode=new Element("div",{styles:this.css.searchBarActionNode}).inject(this.searchBarNode);this.searchBarResetActionNode=new Element("div",{styles:this.css.searchBarResetActionNode}).inject(this.searchBarNode);this.searchBarResetActionNode.setStyle("display","none");this.searchBarInputBoxNode=new Element("div",{styles:this.css.searchBarInputBoxNode}).inject(this.searchBarNode);this.searchBarInputNode=new Element("input",{type:"text",value:this.options.searchKey!=""?this.options.searchKey:this.app.lp.searchKey,styles:this.css.searchBarInputNode}).inject(this.searchBarInputBoxNode);var t=this;this.searchBarActionNode.addEvent("click",function(){this.search()}.bind(this));this.searchBarResetActionNode.addEvent("click",function(){this.reset()}.bind(this));this.searchBarInputNode.addEvents({focus:function(){if(this.value==t.app.lp.searchKey)this.set("value","")},blur:function(){if(!this.value)this.set("value",t.app.lp.searchKey)},keydown:function(t){if(t.code==13){this.search();t.preventDefault()}}.bind(this),selectstart:function(t){t.preventDefault()}})},search:function(t){if(!t)t=this.searchBarInputNode.get("value");if(t==this.app.lp.searchKey)t="";if(t!=""){this.searchBarResetActionNode.setStyle("display","block");this.searchBarActionNode.setStyle("display","none")}this.options.searchKey=t;this.clearContentNode();this.loadView()},clearContentNode:function(){this.elementContentNode.empty()},reset:function(){this.searchBarInputNode.set("value",this.app.lp.searchKey);this.searchBarResetActionNode.setStyle("display","none");this.searchBarActionNode.setStyle("display","block");this.options.searchKey="";this.clearContentNode();this.loadView()}});MWF.xApplication.cms.Module.ListExplorer.DefaultList=new Class({initialize:function(t,e,i,s,o){this.container=t;this.app=e;this.explorer=i;this.css=i.css;this.actions=i.actions;this.data=s;this.searchKey=o},initData:function(){this.items=[];this.documents={};this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0},load:function(){this.initData();this.node=new Element("div",{styles:this.css.elementContentListNode}).inject(this.container);this.table=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",class:"editTable"}).inject(this.node);this.initSortData();this.createListHead();this.loadElementList()},initSortData:function(){},clear:function(){this.documents=null;MWF.release(this.items);this.items=[];this.documents={};this.container.empty();this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0},reload:function(){this.clear();this.node=new Element("div",{styles:this.css.elementContentListNode}).inject(this.container);this.table=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",class:"editTable"}).inject(this.node);this.createListHead();this.loadElementList()},resort:function(t){this.orderField=t.retrieve("field");var e=t.retrieve("orderType");if(e==""){this.orderType="asc"}else if(this.orderType=="asc"){this.orderType="desc"}else{this.orderField="";this.orderType=""}this.reload()},createListHead:function(){var s=this;var o=new Element("tr",{styles:this.css.listHeadNode}).inject(this.table);var t=this.explorer.path+"listItem.json";MWF.getJSON(t,function(t){this.listItemTemplate=t;t.each(function(t){var e=true;if(t.access){if(t.access=="admin"&&!this.explorer.options.isAdmin){e=false}}if(e){var i=new Element("th",{styles:this.css[t.headStyles],width:t.width,text:t.title}).inject(o);if(t.sortByClickTitle=="yes"){i.store("field",t.item);if(this.orderField==t.item&&this.orderType!=""){i.store("orderType",this.orderType);this.sortIconNode=new Element("div",{styles:this.orderType=="asc"?this.css.sortIconNode_asc:this.css.sortIconNode_desc}).inject(i,"bottom")}else{i.store("orderType","");this.sortIconNode=new Element("div",{styles:this.css.sortIconNode}).inject(i,"bottom")}i.setStyle("cursor","pointer");i.addEvent("click",function(){s.resort(this)})}}}.bind(this))}.bind(this),false)},loadElementList:function(t){if(!this.isItemsLoaded){if(!this.isItemLoadding){this.isItemLoadding=true;this._getCurrentPageData(function(t){this.count=t.count;if(t.count<=this.items.length){this.isItemsLoaded=true}t.data.each(function(t){if(!this.documents[t.id]){var e=this._createItem(t);this.items.push(e);this.documents[t.id]=e}}.bind(this));this.isItemLoadding=false;if(this.loadItemQueue>0){this.loadItemQueue--;this.loadElementList()}}.bind(this),t)}else{this.loadItemQueue++}}},_getCurrentPageData:function(e,t){if(!t)t=20;var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";var s={categoryIdList:[this.explorer.categoryData.id],statusList:[this.explorer.options.status],orderField:this.orderField||null,orderType:this.orderType||null};if(this.searchKey&&this.searchKey!=""){s.title=this.searchKey}if(this.filter&&this.filter.filter){var o=this.filter.getFilterResult();for(var n in o){s[n]=o[n]}this.actions.listDocumentFilterNext(i,t||this.pageCount,s,function(t){if(e)e(t)})}else{this.actions.listDocumentFilterNext(i,t||this.pageCount,s,function(t){if(e)e(t)})}},removeDocument:function(t,e){var i=t.data.id;this.actions.removeDocument(i,function(t){this.items.erase(this.documents[i]);this.documents[i].destroy();MWF.release(this.documents[i]);this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_createItem:function(t){return new MWF.xApplication.cms.Module.ListExplorer.DefaultDocument(this.table,t,this.explorer,this)}});MWF.xApplication.cms.Module.ListExplorer.ListForALL=new Class({Extends:MWF.xApplication.cms.Module.ListExplorer.DefaultList,createListHead:function(){var s=this;var o=new Element("tr",{styles:this.css.listHeadNode}).inject(this.table);var t=this.explorer.path+"listItemForAll.json";MWF.getJSON(t,function(t){this.listItemTemplate=t;t.each(function(t){var e=true;if(t.access){if(t.access=="admin"&&!this.explorer.options.isAdmin){e=false}}if(e){var i=new Element("th",{styles:this.css[t.headStyles],width:t.width,text:t.title}).inject(o)}if(t.sortByClickTitle=="yes"){i.store("field",t.item);if(this.orderField==t.item&&this.orderType!=""){i.store("orderType",this.orderType);this.sortIconNode=new Element("div",{styles:this.orderType=="asc"?this.css.sortIconNode_asc:this.css.sortIconNode_desc}).inject(i,"bottom")}else{i.store("orderType","");this.sortIconNode=new Element("div",{styles:this.css.sortIconNode}).inject(i,"bottom")}i.setStyle("cursor","pointer");i.addEvent("click",function(){s.resort(this)})}}.bind(this))}.bind(this),false)},_getCurrentPageData:function(e,t){if(!t)t=20;var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";var s={appIdList:[this.explorer.columnData.id],statusList:[this.explorer.options.status],orderField:this.orderField||null,orderType:this.orderType||null};if(this.searchKey&&this.searchKey!=""){s.title=this.searchKey}if(this.filter&&this.filter.filter){var o=this.filter.getFilterResult();for(var n in o){s[n]=o[n]}this.actions.listDocumentFilterNext(i,t||this.pageCount,s,function(t){if(e)e(t)})}else{this.actions.listDocumentFilterNext(i,t||this.pageCount,s,function(t){if(e)e(t)})}}});MWF.xApplication.cms.Module.ListExplorer.List=new Class({Extends:MWF.xApplication.cms.Module.ListExplorer.DefaultList,initSortData:function(){this.orderField=this.data.orderField?this.data.orderField:"";this.orderType=this.data.orderType?this.data.orderType:"";this.viewId=this.data.id;this.categoryId=this.explorer.categoryData.id;this.status=this.explorer.options.status},createListHead:function(){var s=this;var o=new Element("tr",{styles:this.css.listHeadNode}).inject(this.table);this.data.content.columns.each(function(t){var e=t.widthType=="px"?t.width+"px":t.widthPer+"%";var i=new Element("th",{styles:this.css.normalThNode,width:e,text:t.title?t.title:""}).inject(o);if(t.sortByClickTitle=="yes"){i.store("field",t.value);if(this.orderField==t.value&&this.orderType!=""){i.store("orderType",this.orderType);this.sortIconNode=new Element("div",{styles:this.orderType.toLowerCase()=="asc"?this.css.sortIconNode_asc:this.css.sortIconNode_desc}).inject(i,"bottom")}else{i.store("orderType","");this.sortIconNode=new Element("div",{styles:this.css.sortIconNode}).inject(i,"bottom")}i.setStyle("cursor","pointer");i.addEvent("click",function(){s.resort(this)})}}.bind(this))},resort:function(t){this.orderField=t.retrieve("field");this.orderType=(t.retrieve("orderType")||"").toLowerCase();if(this.orderType==""){this.orderType="asc"}else if(this.orderType=="asc"){this.orderType="desc"}else{this.orderField=this.data.orderField?this.data.orderField:"";this.orderType=this.data.orderType?this.data.orderType:""}this.reload()},_getCurrentPageData:function(e,t){if(!t)t=20;var i=this.items.length?this.items[this.items.length-1].data.document.id:"(0)";var s={orderField:this.orderField,orderType:this.orderType,categoryId:this.categoryId,viewId:this.viewId,searchDocStatus:this.status};this.actions.listViewDataNext(i,t,s,function(t){t.data.each(function(t){if(!t.id)t.id=t.document.id;if(!t.title)t.title=t.document.title});if(e)e(t)})},_createItem:function(t){return new MWF.xApplication.cms.Module.ListExplorer.Document(this.table,t,this.explorer,this)}});MWF.xApplication.cms.Module.ListExplorer.Filter=new Class({initialize:function(t,e,i,s,o,n,r){this.app=t;this.explorer=e;this.css=r;this.actions=n;this.filterNode=$(i);this.filterActionNode=$(s);this.filterConditionNode=o},load:function(){var t=this.explorer.path+"filterItem.json";MWF.getJSON(t,function(t){this.filterSetting=t;if(!this.isFilterOpen){if(!this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.showFilter()}else{if(this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.hideFilter()}}.bind(this))},showFilter:function(){if(!this.filterAreaNode)this.createFilterAreaNode();this.filterAreaTipNode.setStyle("display","block");this.filterAreaNode.setStyle("display","block");this.resizeFilterAreaNode();var t={width:"460px",height:"500px"};this.isFilterOpen=true;this.filterAreaMorph.start(t).chain(function(){this.createFilterAreaTitle();this.createFilterAreaContent();this.hideFilterFun=this.hideFilter.bind(this);$(document.body).addEvent("click",this.hideFilterFun)}.bind(this))},hideFilter:function(){if(this.filterAreaNode){var t={width:"460px",height:"0px"};this.filterAreaNode.empty();this.isFilterOpen=false;this.filterAreaMorph.start(t).chain(function(){this.filterAreaNode.eliminate("input");this.filterAreaNode.setStyle("display","none");this.filterAreaTipNode.setStyle("display","none");$(document.body).removeEvent("click",this.hideFilterFun)}.bind(this));$(document.body).removeEvent("click",this.hideFilterFun)}},createFilterAreaNode:function(){this.filterAreaNode=new Element("div",{styles:this.css.filterAreaNode}).inject(this.app.content);this.filterAreaNode.addEvent("click",function(t){t.stopPropagation()});this.filterAreaTipNode=new Element("div",{styles:this.css.filterAreaTipNode}).inject(this.app.content);this.filterAreaNode.setStyles({width:"460px",height:"0px"});this.filterAreaNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"upperRight",offset:{x:-20,y:-1}});this.filterAreaTipNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"bottomRight",offset:{x:-38,y:0}});this.app.addEvent("resize",function(){this.resizeFilterAreaNode()}.bind(this));this.filterAreaMorph=new Fx.Morph(this.filterAreaNode,{duration:"100",transition:Fx.Transitions.Sine.easeInOut})},resizeFilterAreaNode:function(){if(this.filterAreaNode){this.filterAreaNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"upperRight",offset:{x:-20,y:-1}});if(this.filterAreaTipNode){this.filterAreaTipNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"bottomRight",offset:{x:-38,y:0}})}}},createFilterAreaTitle:function(){var t=new Element("div",{styles:this.css.filterAreaTitleNode}).inject(this.filterAreaNode);var e=new Element("div",{styles:this.css.filterAreaTitleActionOkNode,text:this.app.lp.ok}).inject(t);var i=new Element("div",{styles:this.css.filterAreaTitleActionClearNode,text:this.app.lp.clear}).inject(t);i.addEvent("click",function(){this.filterAreaNode.getElements(".filterItem").each(function(t){this.unSelectedFilterItem(t)}.bind(this));var t=this.filterAreaNode.retrieve("input");t.set("value","");this.filter=null;this.hideFilter();this.setFilterConditions();this.explorer.reloadElementContent()}.bind(this));e.addEvent("click",function(){var t=this.filterAreaNode.retrieve("input");if(!this.filter)this.filter={};var e=t.get("value");if(e&&e!=this.app.lp.searchKey){this.filter.key=e}else{this.filter.key="";delete this.filter.key}this.hideFilter();this.setFilterConditions();this.explorer.reloadElementContent()}.bind(this));var s=new Element("div",{styles:this.css.filterAreaTitleSearchNode}).inject(t);var o=new Element("div",{styles:this.css.filterAreaTitleSearchIconNode}).inject(s);var n=new Element("div",{styles:this.css.filterAreaTitleSearchInputAreaNode}).inject(s);var r=new Element("input",{styles:this.css.filterAreaTitleSearchInputNode,value:this.app.lp.searchKey}).inject(n);if(this.filter){if(this.filter.key)r.set("value",this.filter.key)}this.filterAreaNode.store("input",r);var a=this.app.lp.searchKey;r.addEvents({blur:function(){if(!this.get("value"))this.set("value",a)},focus:function(){if(this.get("value")==a)this.set("value","")},keydown:function(t){if(t.code==13){var e=this.filterAreaNode.retrieve("input");if(!this.filter)this.filter={};var i=e.get("value");if(i&&i!=this.app.lp.searchKey){this.filter.key=i}else{this.filter.key="";delete this.filter.key}this.hideFilter();this.setFilterConditions();this.explorer.reloadElementContent()}}.bind(this)})},createFilterAreaContent:function(){var t=new Element("div",{styles:this.css.applicationFilterAreaContentScrollNode}).inject(this.filterAreaNode);var o=new Element("div",{styles:{overflow:"hidden"}}).inject(t);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(t,{style:"xApp_filter",where:"after",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));var n=this;this._getFilterCount(function(t){Object.each(t,function(t,i){var e=new Element("div",{styles:this.css.applicationFilterCategoryNode}).inject(o);e.set("text",t.name);var s=new Element("div",{styles:this.css.applicationFilterItemAreaNode}).inject(o);t.data.each(function(t){var e=new Element("div",{styles:this.css.applicationFilterItemNode}).inject(s);e.set("text",t.name+"("+t.count+")");e.store("value",t.value);e.store("textname",t.name);e.store("key",i);e.store("resultItemName",t.resultItemName);e.addEvent("click",function(){if(this.hasClass("applicationFilterItemNode_over")){n.unSelectedFilterItem(this)}else{n.selectedFilterItem(this)}});if(this.filter){if(this.filter[i]){if(t.value==this.filter[i][0].value){this.selectedFilterItem(e)}}}}.bind(this))}.bind(this))}.bind(this))},_getFilterCount:function(e){var t="listCategoryDraftFilterAttribute";if(this.explorer.options.status=="published"){t="listCategoryPublishFilterAttribute"}else if(this.explorer.options.status=="archived"){t="listCategoryArchiveFilterAttribute"}this.actions[t](this.explorer.categoryData.id,function(t){this.filterAttribute={};Object.each(t.data,function(t,e){var i=this.filterSetting[e];if(i){var s=this.filterAttribute[i.resultListKey]={name:i.categoryTitle,data:[]};t.each(function(t){s.data.push({name:t[i.itemNameKey],value:t[i.itemValueKey],count:t.count,resultItemName:i.resultItemName})})}}.bind(this));if(e)e(this.filterAttribute)}.bind(this))},unSelectedFilterItem:function(t){if(t.hasClass("applicationFilterItemNode_over")){var e=t.retrieve("value");var i=t.retrieve("textname");var s=t.retrieve("key");t.setStyles(this.css.applicationFilterItemNode);t.removeClass("applicationFilterItemNode_over");t.addClass("applicationFilterItemNode");if(!this.filter)this.filter={};this.filter[s]=null;delete this.filter[s];t.getParent().eliminate("current")}},selectedFilterItem:function(t){if(!t.hasClass("applicationFilterItemNode_over")){var e=t.getParent().retrieve("current");if(e)this.unSelectedFilterItem(e);var i=t.retrieve("value");var s=t.retrieve("key");var o=t.retrieve("textname");var n=t.retrieve("resultItemName");t.setStyles(this.css.applicationFilterItemNode_over);t.removeClass("applicationFilterItemNode");t.addClass("applicationFilterItemNode_over");if(!this.filter)this.filter={};this.filter[s]=[{value:i,name:o,resultItemName:n}];t.getParent().store("current",t)}},searchElement:function(){if(!this.filter)this.filter={};var t=this.searchElementInputNode.get("value");if(t&&t!=this.app.lp.searchKey){this.filter.key=t;this.hideFilter();this.setFilterConditions();this.explorer.reloadElementContent()}},setFilterConditions:function(){this.filterConditionNode.empty();if(this.filter){Object.each(this.filter,function(t,e){if(e!="key"){this.createFilterItemNode(e,t[0])}}.bind(this));if(this.filter.key){this.createFilterItemNode("key",{name:this.filter.key})}}},createFilterItemNode:function(t,e){var i=this;var s=new Element("div",{styles:this.css.filterListItemNode}).inject(this.filterConditionNode);var o=new Element("div",{styles:this.css.filterListItemActionNode}).inject(s);var n=new Element("div",{styles:this.css.filterListItemTextNode}).inject(s);if(t!="key"){n.set("text",this.filterAttribute[t].name+": "+e.name)}else{n.set("text",this.filterSetting.key.categoryTitle+": "+e.name)}o.store("key",t);s.addEvents({mouseover:function(){this.setStyles(i.css.filterListItemNode_over);this.getLast().setStyles(i.css.filterListItemTextNode_over);this.getFirst().setStyles(i.css.filterListItemActionNode_over)},mouseout:function(){this.setStyles(i.css.filterListItemNode);this.getLast().setStyles(i.css.filterListItemTextNode);this.getFirst().setStyles(i.css.filterListItemActionNode)}});o.addEvent("click",function(){var t=this.retrieve("key");if(i.filter[t])i.filter[t]=null;delete i.filter[t];this.destroy();i.setFilterConditions();i.explorer.reloadElementContent()})},getFilterResult:function(){var i={};Object.each(this.filter,function(t,e){if(e=="key"&&this.filterSetting.key){i[this.filterSetting.key.resultListKey]=[{name:this.filterSetting.key.resultItemName,value:t}]}else{i[e]=[{name:t[0].resultItemName,value:t[0].value}]}}.bind(this));return i}});MWF.xApplication.cms.Module.ListExplorer.DefaultDocument=new Class({initialize:function(t,e,i,s){this.explorer=i;this.app=i.app;this.data=e;this.container=t;this.view=s;this.css=this.explorer.css;this.load()},load:function(){this.node=new Element("tr",{styles:this.css.documentItemNode});this.node.inject(this.container);this.view.listItemTemplate.each(function(t){var e=true;if(t.access){if(t.access=="admin"&&!this.explorer.options.isAdmin){e=false}}if(e){this[t.name]=new Element("td",{styles:this.css[t.contentStyles],text:this.data[t.item]?this.data[t.item]:""}).inject(this.node)}}.bind(this));this.setActions();this.setEvents()},setEvents:function(){this.node.addEvents({mouseover:function(){if(!this.readyRemove)this.node.setStyles(this.css.documentItemDocumentNode_over)}.bind(this),mouseout:function(){if(!this.readyRemove)this.node.setStyles(this.css.documentItemDocumentNode)}.bind(this),click:function(t){this.openDocument(t)}.bind(this)});if(this.setTopNode){this.setTopNode.addEvents({mouseover:function(){this.setTopNode.setStyles(this.css.actionSetTopNode_over)}.bind(this),mouseout:function(){this.setTopNode.setStyles(this.css.actionSetTopNode)}.bind(this),mousedown:function(){this.setTopNode.setStyles(this.css.actionSetTopNode_down)}.bind(this),mouseup:function(){this.setTopNode.setStyles(this.css.actionSetTopNode_over)}.bind(this),click:function(t){this.setTop(t);t.stopPropagation()}.bind(this)})}if(this.shareNode){this.shareNode.addEvents({mouseover:function(){this.shareNode.setStyles(this.css.actionShareNode_over)}.bind(this),mouseout:function(){this.shareNode.setStyles(this.css.actionShareNode)}.bind(this),mousedown:function(){this.shareNode.setStyles(this.css.actionShareNode_down)}.bind(this),mouseup:function(){this.shareNode.setStyles(this.css.actionShareNode_over)}.bind(this),click:function(t){this.share(t);t.stopPropagation()}.bind(this)})}if(this.openNode){this.openNode.addEvents({mouseover:function(){this.openNode.setStyles(this.css.actionOpenNode_over)}.bind(this),mouseout:function(){this.openNode.setStyles(this.css.actionOpenNode)}.bind(this),mousedown:function(){this.openNode.setStyles(this.css.actionOpenNode_down)}.bind(this),mouseup:function(){this.openNode.setStyles(this.css.actionOpenNode_over)}.bind(this),click:function(t){this.openDocument(t);t.stopPropagation()}.bind(this)})}if(this.deleteNode){this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.actionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_over)}.bind(this),click:function(t){this.remove(t);t.stopPropagation()}.bind(this)})}if(this.editNode){this.editNode.addEvents({mouseover:function(){this.editNode.setStyles(this.css.actionEditNode_over)}.bind(this),mouseout:function(){this.editNode.setStyles(this.css.actionEditNode)}.bind(this),mousedown:function(){this.editNode.setStyles(this.css.actionEditNode_down)}.bind(this),mouseup:function(){this.editNode.setStyles(this.css.actionEditNode_over)}.bind(this),click:function(t){this.openDocument(t,true);t.stopPropagation()}.bind(this)})}},setActions:function(){if(this.actionAreaNode){if(this.explorer.options.isAdmin){this.deleteNode=new Element("div",{styles:this.css.actionDeleteNode,title:this.explorer.app.lp["delete"]}).inject(this.actionAreaNode);this.editNode=new Element("div",{styles:this.css.actionEditNode,title:this.explorer.app.lp.edit}).inject(this.actionAreaNode)}}},openDocument:function(t,e){var i="cms.Document"+this.data.id;if(this.app.desktop.apps[i]){this.app.desktop.apps[i].setCurrent()}else{var s={documentId:this.data.id,appId:i,readonly:!e,postDelete:function(){this.view.reload()}.bind(this)};this.explorer.app.desktop.openApplication(t,"cms.Document",s)}},remove:function(t){var e=this.explorer.app.lp;var i;if(!this.data.title||this.data.title=="无标题"){i=e.currentDocument}else{i='"'+this.data.title+'"'}var s=e.deleteDocument.replace(/{title}/g,i);var o=this;this.node.setStyles(this.css.documentItemDocumentNode_remove);this.readyRemove=true;this.explorer.app.confirm("warn",t,e.deleteDocumentTitle,s,350,120,function(){o.view.removeDocument(o,false);this.close()},function(){o.node.setStyles(o.css.documentItemDocumentNode);o.readyRemove=false;this.close()})},destroy:function(){this.node.destroy()},setPersonData:function(){var t={actions:this.explorer.personActions,app:{lp:this.explorer.app.lp}};new MWF.widget.O2Identity({name:this.data.creatorIdentity},this.personAreaNode,{style:"work"})}});MWF.xApplication.cms.Module.ListExplorer.Document=new Class({Extends:MWF.xApplication.cms.Module.ListExplorer.DefaultDocument,load:function(){this.node=new Element("tr",{styles:this.css.documentItemNode}).inject(this.container);this.view.data.content.columns.each(function(t){var e=t.value&&t.value!=""?this.data.document[t.value]||this.data.data[t.value]||"":"";if(typeOf(e)=="array"){var i=[];e.each(function(t){if(typeOf(t)=="object"){if(t.name){i.push(t.name)}}else if(typeOf(t)=="string"){i.push(t)}else if(typeOf(t)=="array"){i.push(t.join(","))}else{i.push(t.toString())}});e=i.join(",")}var s=new Element("td",{styles:this.css.normalTdNode,text:e}).inject(this.node);if(t.align&&t!="center"){if(t.align=="left"){s.setStyle("text-align","left")}else if(t.align=="right"){s.setStyle("text-align","right")}}if(t.operation){if(this.explorer.options.isAdmin){if(t.operation.deleteDocument){this.deleteNode=new Element("div",{styles:this.css.actionDeleteNode,title:this.explorer.app.lp["delete"]}).inject(s)}if(t.operation.editDocument){this.editNode=new Element("div",{styles:this.css.actionEditNode,title:this.explorer.app.lp.edit}).inject(s)}}if(t.operation.share){this.shareNode=new Element("div",{styles:this.css.actionShareNode,title:this.explorer.app.lp.share}).inject(s)}}}.bind(this));this.setEvents()}});