MWF.xApplication.Forum=MWF.xApplication.Forum||{};MWF.xApplication.ForumCategory=MWF.xApplication.ForumCategory||{};MWF.require("MWF.widget.O2Identity",null,false);MWF.xDesktop.requireApp("Forum","Common",null,false);MWF.xDesktop.requireApp("Forum","lp."+MWF.language,null,false);MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.xDesktop.requireApp("Forum","Access",null,false);MWF.xDesktop.requireApp("Forum","ColumnTemplate",null,false);MWF.xDesktop.requireApp("Forum","TopNode",null,false);MWF.xApplication.ForumCategory.options={multitask:false,executable:true};MWF.xApplication.ForumCategory.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"ForumCategory",icon:"icon.png",width:"1230",height:"700",isResize:false,isMax:true,naviMode:false,hasTop:true,hasBreadCrumb:true,autoWidth:false,title:MWF.xApplication.ForumCategory.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.Forum.LP},loadApplication:function(t){this.userName=layout.desktop.session.user.distinguishedName;this.restActions=MWF.Actions.get("x_bbs_assemble_control");this.path="/x_component_ForumCategory/$Main/"+this.options.style+"/";this.createNode();this.loadApplicationContent()},loadController:function(t){this.access=new MWF.xApplication.Forum.Access(this.restActions,this.lp);if(t)t()},createNode:function(){this.content.setStyle("overflow","hidden");this.node=new Element("div",{styles:this.css.node}).inject(this.content)},reload:function(){this.status={categoryId:this.options.categoryId,noteHidden:this.noteNodeHidden};this.openMainPage()},loadApplicationContent:function(){if(!this.options.categoryId&&this.status&&this.status.categoryId){this.options.categoryId=this.status.categoryId}this.loadController(function(){this.access.login(function(){this.loadApplicationLayout()}.bind(this))}.bind(this))},loadApplicationLayout:function(){this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.options.autoWidth?this.css.contentContainerNode_inContaienr:this.css.contentContainerNode}).inject(this.node);this.restActions.getCategory(this.options.categoryId,function(t){this.data=t.data;this.setTitle(this.data.forumName);this.createTopNode();this.middleNode=new Element("div.middleNode",{styles:this.options.autoWidth?this.css.middleNode_inContainer:this.css.middleNode}).inject(this.contentContainerNode);this.createNoteNode();this.createContainerNode()}.bind(this))},loadTopObject:function(t){if(this.options.hasTop){var e=new MWF.xApplication.Forum.TopNode(this.contentContainerNode,this,this,{type:this.options.style,naviModeEnable:true,naviMode:t});e.load()}},createTopNode:function(){this.loadTopObject(false);var t=MWF.xApplication.Forum.ForumSetting[this.options.categoryId].forumColor;if(this.options.hasBreadCrumb||this.data.forumNotice&&this.data.forumNotice!=""){var e=this.topNode=new Element("div.topNode",{styles:this.options.autoWidth?this.css.topNode_inContainer:this.css.topNode}).inject(this.contentContainerNode)}if(this.options.hasBreadCrumb){var o=new Element("div.topTitleMiddleNode",{styles:this.css.topTitleMiddleNode}).inject(e);var i=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleNode,text:this.lp.title}).inject(o);var s=new Element("div.topItemSepNode",{styles:this.css.topItemSepNode,text:">"}).inject(o);i.addEvent("click",function(){if(this.options.naviMode&&this.forumNavi){this.forumNavi.goto(MWFForum.NaviType.main)}else{var t="Forum";if(this.desktop.apps[t]){this.desktop.apps[t].setCurrent()}else{this.desktop.openApplication(null,"Forum",{appId:t})}if(!this.inBrowser){this.close()}}}.bind(this));var i=new Element("div.topItemTitleNode",{styles:this.css.topItemTitleLastNode,text:this.data.forumName}).inject(o)}if(this.data.forumNotice&&this.data.forumNotice!=""){var n=new Element("div",{styles:this.css.topRightNode}).inject(e);n.addEvents({click:function(){if(!this.noteNodeHidden){this.noteNode.setStyle("display","none");this.topRightIconNode.setStyles(this.css.topRightIconDownNode);this.noteNodeHidden=true}else{this.noteNode.setStyle("display","");this.topRightIconNode.setStyles(this.css.topRightIconNode);this.noteNodeHidden=false}}.bind(this)});var a=this.topRightIconNode=new Element("div",{styles:this.css.topRightIconNode}).inject(n);if(this.status&&this.status.noteHidden){this.topRightIconNode.setStyles(this.css.topRightIconDownNode);this.noteNodeHidden=true}}this._createTopContent()},_createTopContent:function(){},createContainerNode:function(){this.createCategory()},createCategory:function(){if(!this.options.naviMode){this.setContentSizeFun=this.setContentSize.bind(this);this.addEvent("resize",this.setContentSizeFun);this.setContentSize()}this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.middleNode);this._createCategory(this.data)},createNoteNode:function(){if(!this.data.forumNotice||this.data.forumNotice.trim()==""){return}var t=this.noteNode=new Element("div.noteNode",{styles:this.css.noteNode}).inject(this.middleNode);var e=new Element("div.noteTopNode",{styles:this.css.noteTopNode}).inject(t);var o=new Element("div.noteTopContent",{styles:this.css.noteTopContent}).inject(e);var i=new Element("div.noteIcon",{styles:this.css.noteIcon}).inject(o);var s=new Element("div.noteTopText",{styles:this.css.noteTopText,text:this.lp.forumNotice}).inject(o);var n=new Element("div.noteContent",{styles:this.css.noteContent,html:this.data.forumNotice}).inject(t);if(this.status&&this.status.noteHidden){t.setStyle("display","none")}},setContentSize:function(){var t={x:0,y:0};var e=this.node.getSize();var o=this.contentContainerNode.getStyle("padding-top").toFloat();var i=this.contentContainerNode.getStyle("padding-bottom").toFloat();var s=e.y-t.y-o-i;this.contentContainerNode.setStyle("height",""+s+"px")},_createCategory:function(t){var e=new Element("div.categoryNode",{styles:this.css.categoryNode}).inject(this.contentNode);var o=new Element("div.categoryTopNode",{styles:this.css.categoryTopNode}).inject(e);var i=new Element("div.categoryTopTitleNode",{styles:this.css.categoryTopTitleNode,text:t.forumName}).inject(o);i.addEvents({click:function(t){this.obj.openCategory(this.data)}.bind({obj:this,data:t})});i.setStyle("color",t.forumColor||this.lp.defaultForumColor);var s=new Element("div.categoryTopRightNode",{styles:this.css.categoryTopRightNode2}).inject(o);this.createPersonNode(s,t.forumManagerName);new Element("div.categoryTopRightNode",{styles:this.css.categoryTopRightNode,text:this.lp.categoryManager+"ï¼š"}).inject(o);var n=new MWF.xApplication.Forum.ColumnTemplate(e,this,this,{type:t.indexListStyle||"type_1_0",style:this.options.naviMode?"naviMode":"default",naviMode:this.options.naviMode,categoryId:t.id,onPostLoad:function(){this.fireEvent("postLoadCategory")}.bind(this)});n.forumNavi=this.forumNavi;n.load()},openNavi:function(){MWF.xDesktop.requireApp("Forum","NaviMode",null,false);this.clearContent();this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.css.contentContainerNode}).inject(this.node);this.loadTopObject(true);this.middleNode=new Element("div.middleNode",{styles:this.css.middleNode}).inject(this.contentContainerNode);this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.middleNode);this.navi=new MWF.xApplication.Forum.NaviMode(this,this.contentNode,{type:MWFForum.NaviType.category,id:this.options.categoryId});this.navi.load()},closeNavi:function(){if(this.navi)this.navi.close()},destroy:function(){this.clearContent()},clearContent:function(){if(this.explorer)this.explorer.destroy();if(this.setContentSizeFun)this.removeEvent("resize",this.setContentSizeFun);if(this.scrollBar&&this.scrollBar.scrollVAreaNode)this.scrollBar.scrollVAreaNode.destroy();if(this.scrollBar)delete this.scrollBar;if(this.contentContainerNode){this.contentContainerNode.destroy()}},openMainPage:function(){this.clearContent();this.loadApplicationLayout()},recordStatus:function(){return{categoryId:this.options.categoryId,noteHidden:this.noteNodeHidden}},openPerson:function(t){var e="ForumPerson"+t;if(this.desktop.apps[t]){this.desktop.apps[t].setCurrent()}else{this.desktop.openApplication(null,"ForumPerson",{personName:t,appId:e})}},createPersonNode:function(i,t){var s=t.split(",");s.each(function(t,e){var o=new Element("span",{text:t.split("@")[0],styles:this.css.person}).inject(i);o.addEvents({mouseover:function(){this.node.setStyles(this.obj.css.person_over)}.bind({node:o,obj:this}),mouseout:function(){this.node.setStyles(this.obj.css.person)}.bind({node:o,obj:this}),click:function(){this.obj.openPerson(this.userName)}.bind({userName:t,obj:this})});if(e!=s.length-1){new Element("span",{text:","}).inject(i)}}.bind(this))}});