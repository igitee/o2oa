MWF.xDesktop.requireApp("process.Xform","Actionbar",null,false);MWF.xApplication.cms.Xform.Actionbar=MWF.CMSActionbar=new Class({Extends:MWF.APPActionbar,_loadUserInterface:function(){this.toolbarNode=this.node.getFirst("div");this.toolbarNode.empty();MWF.require("MWF.widget.SimpleToolbar",function(){this.toolbarWidget=new MWF.widget.SimpleToolbar(this.toolbarNode,{style:this.json.style},this);if(this.json.hideSystemTools){this.setCustomToolbars(this.json.tools,this.toolbarNode);this.toolbarWidget.load()}else{if(this.json.defaultTools){this.setToolbars(this.json.defaultTools,this.toolbarNode,this.readonly);this.setCustomToolbars(this.json.tools,this.toolbarNode);this.toolbarWidget.load()}else{MWF.getJSON("/x_component_cms_Xform/$Form/toolbars.json",function(t){this.setToolbars(t,this.toolbarNode,this.readonly,true);this.setCustomToolbars(this.json.tools,this.toolbarNode);this.toolbarWidget.load()}.bind(this),false)}}}.bind(this))},setCustomToolbars:function(t,n){t.each(function(t){var o=true;if(this.readonly){o=t.readShow}else{o=t.editShow}if(o){o=true;if(t.control){o=this.form.businessData.control[t.control]}if(t.condition){var i=this.form.Macro.exec(t.condition,this);o=!i}if(o){var e=new Element("div",{id:t.id,MWFnodetype:t.type,MWFButtonImage:this.form.path+""+this.form.options.style+"/actionbar/"+t.img,MWFButtonImageOver:this.form.path+""+this.form.options.style+"/actionbar/"+t.img,title:t.title,MWFButtonAction:"runCustomAction",MWFButtonText:t.text}).inject(n);if(t.actionScript){e.store("script",t.actionScript)}if(t.sub){var s=n.getLast();this.setCustomToolbars(t.sub,s)}}}}.bind(this))},setToolbars:function(t,n,r,a){t.each(function(t){var o=true;if(t.control){o=this.form.businessData.control[t.control]}if(!a)if(t.condition){var i=this.form.Macro.exec(t.condition,this);o=!i}if(r){if(!t.read)o=false}else{if(!t.edit)o=false}if(this.json.hideSetPopularDocumentTool&&t.id=="action_popular"){o=false}if(o){var e=new Element("div",{id:t.id,MWFnodetype:t.type,MWFButtonImage:"/x_component_cms_FormDesigner/Module/Actionbar/"+(this.options.style||"default")+"/tools/"+(this.json.style||"default")+"/"+t.img,MWFButtonImageOver:"/x_component_cms_FormDesigner/Module/Actionbar/"+(this.options.style||"default")+"/tools/"+(this.json.style||"default")+"/"+t.img_over,title:t.title,MWFButtonAction:t.action,MWFButtonText:t.text}).inject(n);if(t.sub){var s=n.getLast();this.setToolbars(t.sub,s)}}}.bind(this))},runCustomAction:function(t){var o=t.node.retrieve("script");this.form.Macro.exec(o,this)},saveDocument:function(){this.form.saveDocument()},closeDocument:function(){this.form.closeDocument()},publishDocument:function(){this.form.publishDocument()},archiveDocument:function(){this.form.archiveDocument()},redraftDocument:function(){this.form.redraftDocument()},deleteDocument:function(){this.form.deleteDocument()},editDocument:function(){this.form.editDocument()},setPopularDocument:function(){this.form.setPopularDocument()}});